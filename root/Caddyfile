# =============================================================================
# CADDY CONFIGURATION - PCS Template
# =============================================================================
# Container routing is handled via Docker labels (caddy-docker-proxy)
# This file defines global config and reusable snippets only
# =============================================================================

{
    log {
        output stdout
        format console
    }

    # Disable automatic certificate management (using agent certs instead)
    auto_https disable_certs
}

# =============================================================================
# Snippet: tls_enabled
# =============================================================================
# Use this snippet via Docker label: caddy.import: tls_enabled
# Provides:
#   - TLS with shared certificate from mesh-router-agent
#   - Large file upload support (20GB)
# =============================================================================
(tls_enabled) {
    tls /certs/cert.pem /certs/key.pem

    request_body {
        max_size 20GB
    }
}

# Fallback for direct IP/port access (not matched by label-based routes)
:443 {
    tls /certs/cert.pem /certs/key.pem
    respond "No route matched" 502
}
